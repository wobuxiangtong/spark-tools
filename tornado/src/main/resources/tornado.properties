#kafka.broker.connect=172.31.15.19:9092,172.31.15.19:9093,172.31.15.19:9094
kafka.broker.connect=192.168.31.15:9092,192.168.31.30:9092,192.168.31.30:9093

# test enviromnent
#bonecp.jdb.curl.Ext=jdbc:mysql://192.168.31.15:3306/tornado_batch?useSSL=false&tinyInt1isBit=false&rewriteBatchedStatements=true&useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&jdbcCompliantTruncation=false
#bonecp.jdb.curl=jdbc:mysql://192.168.31.15:3306/tornado?useSSL=false&sessionVariables=sql_mode='NO_ENGINE_SUBSTITUTION'&jdbcCompliantTruncation=false
#bonecp.username=root
#bonecp.password=123456

##test enviromnent
bonecp.jdb.curl.Ext=jdbc:mysql://192.168.31.15:3306/prod_adstailor_statistics?useSSL=false&tinyInt1isBit=false&rewriteBatchedStatements=true&useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&jdbcCompliantTruncation=false
bonecp.jdb.curl=jdbc:mysql://192.168.31.15:3306/prod_adstailor_statistics?useSSL=false&sessionVariables=sql_mode='NO_ENGINE_SUBSTITUTION'&jdbcCompliantTruncation=false
bonecp.username=root
bonecp.password=123456

#online environment
#bonecp.jdb.curl=jdbc:mysql://cacti-tornado.cbukzprwgirb.ap-southeast-1.rds.amazonaws.com:3336/tornado?useSSL=false&tinyInt1isBit=false&rewriteBatchedStatements=true&useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&jdbcCompliantTruncation=false
#bonecp.jdb.curl.Ext=jdbc:mysql://cacti-tornado.cbukzprwgirb.ap-southeast-1.rds.amazonaws.com:3336/tornado_batch?useSSL=false&tinyInt1isBit=false&rewriteBatchedStatements=true&useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&jdbcCompliantTruncation=false
#bonecp.username=tornado
#bonecp.password=c3c9685028296f6790e0aa5972225b07

spark.checkpoint.dir=/var/checkpoint/tornado
conversion.checkpoint.dir=/var/checkpoint/conversion
click.analysis.duration=60
click.analysis.checkpoint = 600
conversion.analysis.duration=30

aws.access_key=AKIAIH5WKI4DLC7DH3LQ
aws.secret_key=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
aws.s3_endpoint=s3-ap-southeast-1.amazonaws.com

jdbc.connection.numbers = 10

tempClickAdTableName = tempClickTable
tempClickAdTableNameExt = tempClickTableExt
tempConversionTableName = tempConversionTable
tempEventAdTableNameExt = tempEventTableExt


adx_uniqueClk_SparkSql = select timezone, getFormatDate(clk_timestamp + timezone*3600) as dated, campaign_id, group_id, aff_id,aff_pub, country_code,province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm, ip,ua,gaid,idfa,adid, count(*) as gross_cnt from tableName  WHERE getFormatDate(clk_timestamp + timezone*3600) = '%s' group by timezone, getFormatDate(clk_timestamp + timezone*3600), campaign_id, group_id, aff_id,aff_pub, country_code,province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm, ip,ua,gaid,idfa,adid
gmt_uniqueClk_SparkSql = select getFormatDate(clk_timestamp) as dated, campaign_id, group_id, aff_id,aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm,ip,ua,gaid,idfa,adid, count(*) as gross_cnt from tableName  WHERE getFormatDate(clk_timestamp) = '%s' group by getFormatDate(clk_timestamp), campaign_id, group_id, aff_id,aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm,ip,ua,gaid,idfa,adid

adx_insert_PvUvSql = INSERT INTO adx_clk_daily_summary (timezone, dated,unionk, campaign_id, group_id, aff_id, aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm , gross_cnt, uniq_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt =?, uniq_cnt =?
gmt_insert_PvUvSql = INSERT INTO gmt_clk_daily_summary (dated, unionk,campaign_id, group_id, aff_id, aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm , gross_cnt,uniq_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt =?, uniq_cnt =?
adx_daliy_summary_insertSql = INSERT INTO adx_daily_summary (timezone,dated,unionk,campaign_id, group_id, aff_id, aff_pub,algorithm,gross_clk_cnt, uniq_clk_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_clk_cnt =?, uniq_clk_cnt =?
gmt_daily_summary_insertSql = INSERT INTO gmt_daily_summary (dated,unionk,campaign_id, group_id, aff_id, aff_pub,algorithm,gross_clk_cnt, uniq_clk_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_clk_cnt =?, uniq_clk_cnt =?

conv_SparkSql = select timezone,conv_timestamp,campaign_id,group_id,aff_id,aff_pub,income_currency,payout_currency,invalid_type,forwarded,income,payout,algorithm, net_profit, tac from conv_daily_summary
event_SparkSql = select timezone,campaign_id,group_id,aff_id,aff_pub,event_value,install_timestamp,event_timestamp,order_amount,order_currency,algorithm,kpi,ip,ua,gaid,idfa,adid,count(*) as gross_cnt from  tableName group by timezone,campaign_id,group_id,aff_id,aff_pub,event_value,install_timestamp,event_timestamp,order_amount,order_currency,algorithm,kpi,ip,ua,gaid,idfa,adid

adx_insert_EventSql = INSERT INTO adx_event_daily_summary (timezone,dated,unionk,campaign_id,group_id,aff_id,aff_pub,event_value,currency,algorithm,gross_cnt,uniq_cnt,in1_retention_cnt,in2_retention_cnt,in7_retention_cnt,in15_retention_cnt,in30_retention_cnt,total_amount)  VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt =gross_cnt+?, uniq_cnt =uniq_cnt+?, in1_retention_cnt =in1_retention_cnt+?,in2_retention_cnt =in2_retention_cnt+?,in7_retention_cnt =in7_retention_cnt+?,in15_retention_cnt =in15_retention_cnt+?,in30_retention_cnt =in30_retention_cnt+?,total_amount =total_amount+?
gmt_insert_EventSql = INSERT INTO gmt_event_daily_summary (dated,unionk,campaign_id,group_id,aff_id,aff_pub,event_value,currency,algorithm,gross_cnt,uniq_cnt,in1_retention_cnt,in2_retention_cnt,in7_retention_cnt,in15_retention_cnt,in30_retention_cnt,total_amount)  VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt =gross_cnt+?, uniq_cnt =uniq_cnt+?, in1_retention_cnt =in1_retention_cnt+?,in2_retention_cnt =in2_retention_cnt+?,in7_retention_cnt =in7_retention_cnt+?,in15_retention_cnt =in15_retention_cnt+?,in30_retention_cnt =in30_retention_cnt+?,total_amount =total_amount+?
adx_insert_KpiSql = INSERT INTO adx_daily_summary (timezone,dated,unionk,campaign_id, group_id, aff_id, aff_pub,algorithm,kpi_event_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE kpi_event_cnt =kpi_event_cnt+?
gmt_insert_KpiSql = INSERT INTO gmt_daily_summary (dated,unionk,campaign_id, group_id, aff_id, aff_pub,algorithm,kpi_event_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE kpi_event_cnt =kpi_event_cnt+?

# ͬʱ����PV��UV
adx_grossClk_queryPvUvSql = SELECT id FROM adx_clk_summary_daily WHERE timezone = ? and dated = ? and campaign_id = ? and group_id = ? and aff_id = ? and aff_pub = ? and country_code = ? and province_geoname_id = ? and city_geoname_id = ? and os = ? and device_type = ? and device_make = ? and device_model = ? LIMIT 1
gmt_grossClk_queryPvUvSql = SELECT id FROM gmt_clk_summary_daily WHERE  dated = ? and campaign_id = ? and group_id = ? and aff_id = ? and aff_pub = ? and country_code = ? and province_geoname_id = ? and city_geoname_id = ? and os = ? and device_type = ? and device_make = ? and device_model = ? LIMIT 1
adx_grossClk_createPvUvSql = INSERT INTO adx_clk_summary_daily (timezone, dated, campaign_id, group_id, aff_id, aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model, gross_cnt, uniq_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
gmt_grossClk_createPvUvSql = INSERT INTO gmt_clk_summary_daily (dated, campaign_id, group_id, aff_id, aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model, gross_cnt,uniq_cnt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
adx_grossClk_updatePvUvSql = UPDATE adx_clk_summary_daily SET gross_cnt = CASE WHEN gross_cnt < ? THEN ? ELSE gross_cnt END,uniq_cnt = CASE WHEN uniq_cnt < ? THEN ? ELSE uniq_cnt END WHERE id = ?
gmt_grossClk_updatePvUvSql = UPDATE gmt_clk_summary_daily SET gross_cnt = CASE WHEN gross_cnt < ? THEN ? ELSE gross_cnt END,uniq_cnt = CASE WHEN uniq_cnt < ? THEN ? ELSE uniq_cnt END WHERE id = ?

# conv log query
#conv_data_from = /var/checkpoint_data/logs/tornado_conversion-{%s,%s,%s}
conv_data_from = s3a://cactiflos/kafka/tornado_conversion/*/tornado_conversion-{%s,%s,%s}
#conv_data_from = /mnt/xvdb/tmp/tornado_conversion-{%s,%s,%s}
#conv_init_query = SELECT click_id,timezone,getFormatDate(conv_timestamp) as dated_gmt,getFormatDate(conv_timestamp + (timezone*3600.0)) as dated_adx,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,invalid_type,forwarded,net_profit,tac from conv_init group by click_id
#
#adx_conv_daily_summary_query = SELECT timezone,dated_adx as dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,count(distinct click_id) as gross_cnt,validGroupCount(invalid_type,click_id) as valid_cnt,notifyGroupCount(forwarded,click_id) as notify_cnt,profitSum(net_profit,click_id) as profit_amount,tacSum(tac,click_id) as tac_amount from conv_summary WHERE dated_adx = '%s' group by timezone,dated_adx,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm
#adx_conv_daily_summary_insert = INSERT INTO adx_conv_daily_summary (timezone,dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,gross_cnt,valid_cnt,notify_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_cnt = ?,valid_cnt = ?,notify_cnt = ?
#
#gmt_conv_daily_summary_query = SELECT dated_gmt as dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,count(distinct click_id) as gross_cnt,validGroupCount(invalid_type,click_id) as valid_cnt,notifyGroupCount(forwarded,click_id) as notify_cnt,profitSum(net_profit,click_id) as profit_amount,tacSum(tac,click_id) as tac_amount from conv_summary WHERE dated_gmt = '%s' group by dated_gmt,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm
#gmt_conv_daily_summary_insert = INSERT INTO gmt_conv_daily_summary (dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,gross_cnt,valid_cnt,notify_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_cnt = ?,valid_cnt = ?,notify_cnt = ?
#
#adx_invalid_conv_daily_summary_query = SELECT timezone,dated_adx as dated,campaign_id,group_id,aff_id,aff_pub,invalid_type,algorithm,invalidGroupCount(invalid_type,click_id) as invalid_cnt from conv_summary  where invalid_type != "" AND  dated_adx = '%s' group by timezone,dated_adx,campaign_id,group_id,aff_id,aff_pub,invalid_type,algorithm
#adx_invalid_conv_daily_summary_insert = INSERT INTO adx_invalid_conv_daily_summary (timezone,dated,campaign_id,group_id,aff_id,aff_pub,invalid_type,algorithm,invalid_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE invalid_cnt = ?
#
#conv_adx_daily_summary_query = SELECT timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm,SUM(gross_cnt) as gross_sum,SUM(valid_cnt) as valid_sum,SUM(notify_cnt) as notify_sum,SUM(profit_amount) as profit_sum,sum(tac_amount) as tac_sum from adx_conv_daily_summary GROUP BY timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm
#conv_adx_daily_summary_insert = INSERT INTO adx_daily_summary (timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm,gross_conv_cnt,valid_conv_cnt,notify_conv_cnt,net_profit,tac,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_conv_cnt = ?,valid_conv_cnt = ?,notify_conv_cnt = ?,net_profit = ?,tac = ?
#
#conv_gmt_daily_summary_query = SELECT dated,campaign_id,group_id,aff_id,aff_pub,algorithm,SUM(gross_cnt) as gross_sum,SUM(valid_cnt) as valid_sum,SUM(notify_cnt) as notify_sum,SUM(profit_amount) as profit_sum,SUM(tac_amount) as tac_sum from gmt_conv_daily_summary GROUP BY dated,campaign_id,group_id,aff_id,aff_pub,algorithm
#conv_gmt_daily_summary_insert = INSERT INTO gmt_daily_summary (dated,campaign_id,group_id,aff_id,aff_pub,algorithm,gross_conv_cnt,valid_conv_cnt,notify_conv_cnt,net_profit,tac,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_conv_cnt = ?,valid_conv_cnt = ?,notify_conv_cnt = ?,net_profit = ?,tac = ?

conv_init_query = SELECT first(timezone) as timezone,first(getFormatDate(conv_timestamp)) as dated_gmt,first(getFormatDate(conv_timestamp + (timezone*3600.0))) as dated_adx,first(campaign_id) as campaign_id,first(group_id) as group_id,first(aff_id) as aff_id,first(aff_pub) as aff_pub,first(income) as income,first(income_currency) as income_currency,first(payout) as payout,first(payout_currency) as payout_currency,first(algorithm) as algorithm,first(invalid_type) as invalid_type,first(forwarded) as forwarded,first(net_profit) as net_profit,first(tac) as tac from conv_init group by click_id

adx_conv_daily_summary_query = SELECT timezone,dated_adx as dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,count(*) as gross_cnt,validGroupCount(invalid_type) as valid_cnt,notifyGroupCount(forwarded) as notify_cnt,sum(net_profit) as profit_amount,sum(tac) as tac_amount from conv_summary WHERE dated_adx = '%s' group by timezone,dated_adx,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm
adx_conv_daily_summary_insert = INSERT INTO adx_conv_daily_summary (timezone,dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,gross_cnt,valid_cnt,notify_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_cnt = ?,valid_cnt = ?,notify_cnt = ?

gmt_conv_daily_summary_query = SELECT dated_gmt as dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,count(*) as gross_cnt,validGroupCount(invalid_type) as valid_cnt,notifyGroupCount(forwarded) as notify_cnt,sum(net_profit) as profit_amount,sum(tac) as tac_amount from conv_summary WHERE dated_gmt = '%s' group by dated_gmt,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm
gmt_conv_daily_summary_insert = INSERT INTO gmt_conv_daily_summary (dated,campaign_id,group_id,aff_id,aff_pub,income,income_currency,payout,payout_currency,algorithm,gross_cnt,valid_cnt,notify_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_cnt = ?,valid_cnt = ?,notify_cnt = ?

adx_invalid_conv_daily_summary_query = SELECT timezone,dated_adx as dated,campaign_id,group_id,aff_id,aff_pub,invalid_type,algorithm,count(invalid_type) as invalid_cnt from conv_summary  where invalid_type != "" AND  dated_adx = '%s' group by timezone,dated_adx,campaign_id,group_id,aff_id,aff_pub,invalid_type,algorithm
adx_invalid_conv_daily_summary_insert = INSERT INTO adx_invalid_conv_daily_summary (timezone,dated,campaign_id,group_id,aff_id,aff_pub,invalid_type,algorithm,invalid_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE invalid_cnt = ?

conv_adx_daily_summary_query = SELECT timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm,SUM(gross_cnt) as gross_sum,SUM(valid_cnt) as valid_sum,SUM(notify_cnt) as notify_sum,SUM(profit_amount) as profit_sum,sum(tac_amount) as tac_sum from adx_conv_daily_summary GROUP BY timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm
conv_adx_daily_summary_insert = INSERT INTO adx_daily_summary (timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm,gross_conv_cnt,valid_conv_cnt,notify_conv_cnt,net_profit,tac,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_conv_cnt = ?,valid_conv_cnt = ?,notify_conv_cnt = ?,net_profit = ?,tac = ?

conv_gmt_daily_summary_query = SELECT dated,campaign_id,group_id,aff_id,aff_pub,algorithm,SUM(gross_cnt) as gross_sum,SUM(valid_cnt) as valid_sum,SUM(notify_cnt) as notify_sum,SUM(profit_amount) as profit_sum,SUM(tac_amount) as tac_sum from gmt_conv_daily_summary GROUP BY dated,campaign_id,group_id,aff_id,aff_pub,algorithm
conv_gmt_daily_summary_insert = INSERT INTO gmt_daily_summary (dated,campaign_id,group_id,aff_id,aff_pub,algorithm,gross_conv_cnt,valid_conv_cnt,notify_conv_cnt,net_profit,tac,unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_conv_cnt = ?,valid_conv_cnt = ?,notify_conv_cnt = ?,net_profit = ?,tac = ?


#conv_warehouse = C:\\Users\\moca\\moca-uni\\spark_sql
#conv_data_from = /var/checkpoint_data/logs/tornado_conversion-{%s,%s,%s}
#conv_data_from = s3a://cactiflos/kafka/tornado_conversion/*/tornado_conversion-{%s,%s,%s}
click_data_from = /var/checkpoint_data/logs/tornado_click-{%s,%s,%s}
event_data_from = /var/checkpoint_data/logs/tornado_event-{%s,%s,%s}
#click_data_from = s3a://cactiflos/kafka/tornado_click/*/tornado_click-{%s,%s,%s}
#event_data_from = s3a://cactiflos/kafka/tornado_event/*/tornado_event-{%s,%s,%s}
impress_data_from = /var/checkpoint_data/logs/dot-impression-{%s,%s,%s}


click.checkpoint.dir = /mnt/xvdb/checkpoint/tornado/click/tornado
#click.checkpoint.dir = /var/checkpoint_data/click
event.checkpoint.dir = /mnt/xvdb/checkpoint/tornado/event/tornado
#event.checkpoint.dir = /var/checkpoint_data/event
#impression.checkpoint.dir = /mnt/xvdb/checkpoint/tornado/impression/tornado
impression.checkpoint.dir = /var/checkpoint_data/impression

demand.checkpoint.dir = /var/checkpoint_data/demand


adx_clk_summary_check = select a.dated,a.timezone,a.gross_sum = b.gross_clk_sum as gross_clk_flag from (select dated,timezone,sum(gross_cnt) as gross_sum from adx_clk_daily_summary where dated = '%s' and timezone = %s group by dated,timezone) a join (select dated,timezone,sum(gross_clk_cnt) as gross_clk_sum from adx_daily_summary where dated = '%s' and timezone = %s group by dated,timezone) b on a.dated = b.dated and a.timezone = b.timezone;
gmt_clk_summary_check = select a.dated,a.gross_sum = b.gross_clk_sum gross_clk_flag from (select dated,sum(gross_cnt) as gross_sum from gmt_clk_daily_summary where dated = '%s' group by dated) a join (select dated,sum(gross_clk_cnt) as gross_clk_sum from gmt_daily_summary where dated = '%s' group by dated) b on a.dated = b.dated;

adx_conv_summary_check = select a.dated,a.timezone,a.gross_sum = b.gross_conv_sum as gross_conv_flag,a.valid_sum = b.valid_conv_sum as valid_conv_flag,a.notify_sum = b.notify_conv_sum as notify_conv_flag from (select dated,timezone,sum(gross_cnt) as gross_sum,sum(valid_cnt) as valid_sum,sum(notify_cnt) as notify_sum from adx_conv_daily_summary where dated = '%s' and timezone = %s group by dated,timezone) a join (select dated,timezone,sum(gross_conv_cnt) as gross_conv_sum,sum(valid_conv_cnt) as valid_conv_sum,sum(notify_conv_cnt) as notify_conv_sum from adx_daily_summary where dated = '%s' and timezone = %s group by dated,timezone) b on a.dated = b.dated and a.timezone = b.timezone;
gmt_conv_summary_check = select a.dated,a.gross_sum = b.gross_conv_sum as gross_conv_flag,a.valid_sum = b.valid_conv_sum as valid_conv_flag,a.notify_sum = b.notify_conv_sum as notify_conv_flag from (select dated,sum(gross_cnt) as gross_sum,sum(valid_cnt) as valid_sum,sum(notify_cnt) as notify_sum from gmt_conv_daily_summary where dated = '%s' group by dated) a join (select dated,sum(gross_conv_cnt) as gross_conv_sum,sum(valid_conv_cnt) as valid_conv_sum,sum(notify_conv_cnt) as notify_conv_sum from gmt_daily_summary where dated = '%s' group by dated) b on a.dated = b.dated;

adx_event_summary_check = select a.dated,a.timezone,a.gross_sum = b.gross_conv_sum,a.valid_sum = b.valid_conv_sum,a.notify_sum = b.notify_conv_sum from (select dated,timezone,sum(gross_cnt) as gross_sum,sum(valid_cnt) as valid_sum,sum(notify_cnt) as notify_sum from adx_conv_daily_summary where dated = '%s' and timezone = %s group by dated,timezone) a join (select dated,timezone,sum(gross_conv_cnt) as gross_conv_sum,sum(valid_conv_cnt) as valid_conv_sum,sum(notify_conv_cnt) as notify_conv_sum from adx_daily_summary where dated = '%s' and timezone = %s group by dated,timezone) b on a.dated = b.dated and a.timezone = b.timezone;
gmt_event_summary_check = select a.dated,a.gross_sum = b.gross_conv_sum,a.valid_sum = b.valid_conv_sum,a.notify_sum = b.notify_conv_sum from (select dated,sum(gross_cnt) as gross_sum,sum(valid_cnt) as valid_sum,sum(notify_cnt) as notify_sum from gmt_conv_daily_summary where dated = '%s' group by dated) a join (select dated,sum(gross_conv_cnt) as gross_conv_sum,sum(valid_conv_cnt) as valid_conv_sum,sum(notify_conv_cnt) as notify_conv_sum from gmt_daily_summary where dated = '%s' group by dated) b on a.dated = b.dated;


click_init_query = select timezone, getFormatDate(clk_timestamp + timezone*3600.0) as dated_adx,getFormatDate(clk_timestamp) as dated_gmt, campaign_id, group_id, aff_id,aff_pub, country_code,province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm, uvGenerator(ip,ua,gaid,idfa,adid) as uv_tied from click_init
adx_click_daily_summary_query = select timezone,dated_adx as dated,campaign_id,group_id,aff_id,aff_pub,country_code,province_geoname_id,city_geoname_id,os,device_type,device_make,device_model,algorithm,count(*) as gross_cnt,count(distinct uv_tied) as uniq_cnt from click_summary where dated_adx = '%s' group by timezone,dated_adx,campaign_id,group_id,aff_id,aff_pub,country_code,province_geoname_id,city_geoname_id,os,device_type,device_make,device_model,algorithm
adx_click_daily_summary_insert = INSERT INTO adx_clk_daily_summary (timezone, dated, campaign_id, group_id, aff_id, aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm, gross_cnt, uniq_cnt,unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt = ?,uniq_cnt = ?
click_adx_daily_summary_query = SELECT timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm,SUM(gross_cnt) as gross_sum,SUM(uniq_cnt) as uniq_sum FROM adx_click_daily_summary GROUP BY timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm
click_adx_daily_summary_insert = INSERT INTO adx_daily_summary (timezone,dated,campaign_id,group_id,aff_id,aff_pub,algorithm,gross_clk_cnt,uniq_clk_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_clk_cnt = ?,uniq_clk_cnt = ?

gmt_click_daily_summary_query = select dated_gmt as dated,campaign_id,group_id,aff_id,aff_pub,country_code,province_geoname_id,city_geoname_id,os,device_type,device_make,device_model,algorithm,count(*) as gross_cnt,count(distinct uv_tied) as uniq_cnt from click_summary where dated_gmt = '%s' group by dated_gmt,campaign_id,group_id,aff_id,aff_pub,country_code,province_geoname_id,city_geoname_id,os,device_type,device_make,device_model,algorithm
gmt_click_daily_summary_insert = INSERT INTO gmt_clk_daily_summary (dated, campaign_id, group_id, aff_id, aff_pub, country_code, province_geoname_id, city_geoname_id, os, device_type, device_make, device_model,algorithm, gross_cnt, uniq_cnt,unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt = ?,uniq_cnt = ?
click_gmt_daily_summary_query = SELECT dated,campaign_id,group_id,aff_id,aff_pub,algorithm,SUM(gross_cnt) as gross_sum,SUM(uniq_cnt) as uniq_sum FROM gmt_click_daily_summary GROUP BY dated,campaign_id,group_id,aff_id,aff_pub,algorithm
click_gmt_daily_summary_insert = INSERT INTO gmt_daily_summary (dated,campaign_id,group_id,aff_id,aff_pub,algorithm,gross_clk_cnt,uniq_clk_cnt,unionk) VALUES (?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_clk_cnt = ?,uniq_clk_cnt = ?


event_init_query =  SELECT retentDays(event_timestamp,install_timestamp) as retent_days,timezone,getFormatDate(event_timestamp) as event_dated_gmt,getFormatDate(install_timestamp) as conv_dated_gmt,getFormatDate(event_timestamp + timezone*3600.0) as event_dated_adx,getFormatDate(install_timestamp + timezone*3600.0) as conv_dated_adx,campaign_id,group_id,aff_id,aff_pub,event_value,order_amount,substring(order_currency,1,3) as currency,algorithm,kpi,click_id FROM event_init
adx_event_daily_summary_pvuv_query = SELECT retent_days,kpi,timezone,conv_dated_adx,event_dated_adx,campaign_id,group_id,aff_id,aff_pub,event_value,currency,algorithm,count(*) as gross_cnt,count(distinct click_id) as uniq_cnt,sum(order_amount) as total_amount from event_summary WHERE event_dated_adx = '%s' GROUP BY retent_days,kpi,timezone, conv_dated_adx,event_dated_adx, campaign_id, group_id, aff_id, aff_pub, event_value, currency, algorithm
adx_event_daily_summary_pvuv_insert = INSERT INTO adx_event_daily_summary (timezone, dated, campaign_id, group_id, aff_id, aff_pub, event_value, currency, algorithm, gross_cnt, uniq_cnt, total_amount, unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt = gross_cnt + ?, uniq_cnt = uniq_cnt + ?, total_amount = total_amount + ?
adx_event_daily_summary_retent_insert = INSERT INTO adx_event_daily_summary (timezone, dated, campaign_id, group_id, aff_id, aff_pub, event_value, currency, algorithm, in1_retention_cnt, in2_retention_cnt, in7_retention_cnt, in15_retention_cnt, in30_retention_cnt, unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE in1_retention_cnt = in1_retention_cnt + ?, in2_retention_cnt = in2_retention_cnt + ?, in7_retention_cnt = in7_retention_cnt + ?, in15_retention_cnt = in15_retention_cnt + ?, in30_retention_cnt = in30_retention_cnt + ?
event_adx_daily_summary_insert = INSERT INTO adx_daily_summary (timezone, dated, campaign_id, group_id, aff_id, aff_pub, algorithm, kpi_event_cnt, unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE  kpi_event_cnt = kpi_event_cnt + ?

gmt_event_daily_summary_pvuv_query = SELECT retent_days,kpi,conv_dated_gmt,event_dated_gmt,campaign_id,group_id,aff_id,aff_pub,event_value,currency,algorithm,count(*) as gross_cnt,count(distinct click_id) as uniq_cnt,sum(order_amount) as total_amount from event_summary WHERE event_dated_gmt = '%s' GROUP BY retent_days,kpi,conv_dated_gmt,event_dated_gmt, campaign_id, group_id, aff_id, aff_pub, event_value, currency, algorithm
gmt_event_daily_summary_pvuv_insert = INSERT INTO gmt_event_daily_summary (dated, campaign_id, group_id, aff_id, aff_pub, event_value, currency, algorithm, gross_cnt, uniq_cnt, total_amount, unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE gross_cnt = gross_cnt + ?, uniq_cnt = uniq_cnt + ?, total_amount = total_amount + ?
gmt_event_daily_summary_retent_insert = INSERT INTO gmt_event_daily_summary (dated, campaign_id, group_id, aff_id, aff_pub, event_value, currency, algorithm, in1_retention_cnt, in2_retention_cnt, in7_retention_cnt, in15_retention_cnt, in30_retention_cnt, unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE in1_retention_cnt = in1_retention_cnt + ?, in2_retention_cnt = in2_retention_cnt + ?, in7_retention_cnt = in7_retention_cnt + ?, in15_retention_cnt = in15_retention_cnt + ?, in30_retention_cnt = in30_retention_cnt + ?
event_gmt_daily_summary_insert = INSERT INTO gmt_daily_summary (dated, campaign_id, group_id, aff_id, aff_pub, algorithm, kpi_event_cnt, unionk) VALUES (?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE  kpi_event_cnt = kpi_event_cnt + ?

impress_init_query = select timezone, getFormatDate(request_unix + timezone*3600.0) as dated_adx, getFormatDate(request_unix) as dated_gmt,publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, option.country_code as country_code, option.region_ids[0] as province_geoname_id, getLast(option.region_ids) as city_geoname_id,option.devicetype as device_type,option.make as make,option.model as model,option.os as os,option.carrier as carrier,option.connectiontype as connection_type,option.agegroup as age_group,option.gender as gender,option.ip as ip,option.ua as ua,option.gaid as gaid,option.idfa as idfa from impress_init
impress_adx_daily_summary_query = select timezone, dated_adx as dated,publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender,count(*) as gross_cnt,count(distinct uvGenerator(ip,ua,gaid,idfa,'')) as uniq_cnt from impress_summary where dated_adx = '%s' group by timezone, dated_adx,publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender
impress_adx_daily_summary_insert = INSERT INTO adx_daily_summary (timezone, dated, publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender,unionk, gross_imp_cnt, uniq_imp_cnt) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_imp_cnt = gross_imp_cnt + ?,uniq_imp_cnt = uniq_imp_cnt + ?
click_impress_adx_daily_summary_insert = INSERT INTO adx_daily_summary (timezone, dated, publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender,unionk, gross_clk_cnt, uniq_clk_cnt) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_clk_cnt = gross_clk_cnt + ?,uniq_clk_cnt = uniq_clk_cnt + ?

impress_gmt_daily_summary_query = select dated_gmt as dated,publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender,count(*) as gross_cnt,count(distinct uvGenerator(ip,ua,gaid,idfa,'')) as uniq_cnt from impress_summary where dated_gmt = '%s' group by dated_gmt,publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender
impress_gmt_daily_summary_insert = INSERT INTO gmt_daily_summary (dated, publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender,unionk, gross_imp_cnt, uniq_imp_cnt) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_imp_cnt = gross_imp_cnt + ?,uniq_imp_cnt = uniq_imp_cnt + ?
click_impress_gmt_daily_summary_insert = INSERT INTO gmt_daily_summary (dated, publisher_id, inventory_id, plcmt_id, campaign_id, delivery_id, ad_id, country_code, province_geoname_id, city_geoname_id, device_type, make, model, os, carrier, connection_type, age_group, gender,unionk, gross_clk_cnt, uniq_clk_cnt) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE gross_clk_cnt = gross_clk_cnt + ?,uniq_imp_cnt = uniq_imp_cnt + ?


demand_init_query = select tz as timezone,getFormatDate(clickts + tz*3600.0) as dated_adx,getFormatDate(clickts) as dated_gmt,demand,cid as campaign_id,crid as creative_id,supply,domainSelect(app.publisher.domain,site.publisher.domain) as publisher_domain,domainSelect(app.domain,site.domain) as inventory_domain,app.bundle as app_bundle,tagid,geo.cc as country_code,geo.pgeonid as province_geonameid,geo.cgeonid as city_geonameid,device.make as device_make,device.model as device_model,device.os as os,device.carrier as carrier,device.connectiontype as connection_type,uagrp as age_group,user.gender as gender,dcostcur as demand_currency,srevenuecur as supply_currency,uvSelect(device.dpidsha1,device.dpidmd5,device.didsha1,device.didmd5,device.macsha1,device.macmd5,device.ip,device.ua,device.hwv) as uv,dcost as demand_cost,srevenue as supply_revenue from demand_init
adx_demand_daily_summary_query = select timezone,dated_adx,demand,campaign_id,creative_id,supply,publisher_domain,inventory_domain,app_bundle,tagid,country_code,province_geonameid,city_geonameid,device_make,device_model,os,carrier,connection_type,age_group,gender,demand_currency,count(*) as gross_cnt,count(distinct uv) as uniq_cnt,sum(demand_cost) as cost_sum from demand_summary where dated_adx = '%s' group by timezone,dated_adx,demand,campaign_id,creative_id,supply,publisher_domain,inventory_domain,app_bundle,tagid,country_code,province_geonameid,city_geonameid,device_make,device_model,os,carrier,connection_type,age_group,gender,demand_currency
adx_demand_daily_summary_insert = INSERT INTO demand_dailysummary_tz (timezone,dated,demand,campaign_id,creative_id,supply,publisher_domain,inventory_domain,app_bundle,tagid,country_code,province_geonameid,city_geonameid,device_make,device_model,os,carrier,connection_type,age_group,gender,currency,clks,uniq_clks,cost, unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE clks = ?, uniq_clks = ?, cost = ?
gmt_demand_daily_summary_query = select dated_gmt,demand,campaign_id,creative_id,supply,publisher_domain,inventory_domain,app_bundle,tagid,country_code,province_geonameid,city_geonameid,device_make,device_model,os,carrier,connection_type,age_group,gender,demand_currency,count(*) as gross_cnt,count(distinct uv) as uniq_cnt,sum(demand_cost) as cost_sum from demand_summary where dated_gmt = '%s' group by dated_gmt,demand,campaign_id,creative_id,supply,publisher_domain,inventory_domain,app_bundle,tagid,country_code,province_geonameid,city_geonameid,device_make,device_model,os,carrier,connection_type,age_group,gender,demand_currency
gmt_demand_daily_summary_insert = INSERT INTO demand_dailysummary (dated,demand,campaign_id,creative_id,supply,publisher_domain,inventory_domain,app_bundle,tagid,country_code,province_geonameid,city_geonameid,device_make,device_model,os,carrier,connection_type,age_group,gender,currency,clks,uniq_clks,cost, unionk) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE clks = ?, uniq_clks = ?, cost = ?
gmt_supply_daily_summary_query = select dated_gmt,supply,publisher_domain,inventory_domain,app_bundle,tagid,supply_currency,count(*) as gross_cnt,sum(supply_revenue) as revenue_sum from demand_summary where dated_gmt = '%s' group by dated_gmt,supply,publisher_domain,inventory_domain,app_bundle,tagid,supply_currency
gmt_supply_daily_summary_insert = INSERT INTO supply_dailysummary (dated,supply,publisher_domain,inventory_domain,app_bundle,tagid,currency,clks,revenue, unionk) VALUES (?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE clks = ?, revenue = ?

demand_data_from = /var/checkpoint_data/logs/tornado_demand-{%s,%s,%s}